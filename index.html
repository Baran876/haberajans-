<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haber Ajansı</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .text-logo {
            font-family: 'Oswald', sans-serif;
        }
        .view {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="bg-gray-900 text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <span class="text-4xl font-bold text-red-500 text-logo">A HABER</span>
                <button onclick="window.showView('home')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Anasayfa</button>
                <button onclick="window.showView('aboutUs')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Hakkımızda</button>
                <button onclick="window.showView('submitNews')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Haber Paylaş</button>
                <button onclick="window.showView('publishers')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Yayıncılar</button>
                <button id="publisherDashboardBtn" onclick="window.showView('publisherDashboard')" class="hover:text-red-400 transition duration-300 transform hover:scale-105 hidden">Yayıncı Paneli</button>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="window.showView('chat')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Sohbet</button>
                <button onclick="window.showView('settings')" class="hover:text-red-400 transition duration-300 transform hover:scale-105">Ayarlar</button>
            </div>
            <div id="authButtons" class="flex items-center space-x-2">
                <button onclick="window.showAuthModal('login')" class="bg-red-600 text-white font-bold py-2 px-4 rounded-full hover:bg-red-700 transition duration-300">Giriş Yap</button>
                <button onclick="window.showAuthModal('signup')" class="bg-green-600 text-white font-bold py-2 px-4 rounded-full hover:bg-green-700 transition duration-300">Kayıt Ol</button>
            </div>
            <div id="userProfile" class="hidden flex items-center space-x-2">
                <span id="userEmailDisplay" class="text-white font-medium"></span>
                <button onclick="window.logout()" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-600 transition duration-300">Çıkış Yap</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-8 container mx-auto">
        
        <!-- View Container -->
        <div id="views" class="space-y-12">

            <!-- Anasayfa -->
            <div id="home" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h1 class="text-4xl font-bold text-gray-900 mb-6">Son Dakika Haberleri</h1>
                <div id="newsFeed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Haberler buraya yüklenecek -->
                </div>
            </div>

            <!-- Hakkımızda Bölümü -->
            <div id="aboutUs" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h1 class="text-4xl font-bold text-gray-900 mb-6 border-b-4 border-red-500 pb-2">Hakkımızda</h1>
                <div class="space-y-6 text-gray-700 leading-relaxed">
                    <p>A Haber, güncel gelişmeleri en hızlı ve doğru şekilde okuyucularına ulaştırmayı hedefleyen modern bir haber ajansı simülasyonudur. Şeffaflık, tarafsızlık ve güvenilirlik ilkeleriyle yola çıkarak, toplumsal olaylara, teknolojiye, ekonomiye ve kültüre dair en önemli haberleri derliyoruz.</p>
                    <p>Platformumuz, bağımsız gazetecilerin ve vatandaş muhabirlerinin sesini duyurmasına olanak tanır. Kullanıcılarımız, sisteme anonim olarak haber gönderimi yapabilir veya yayıncı statüsü alarak onaylanmış haberleri yayınlayabilir. Her haber, yayınlanmadan önce editör ekibimiz tarafından titizlikle incelenir ve teyit edilir.</p>
                    <p>Misyonumuz, bilgiye erişimi kolaylaştırmak ve herkesin doğru habere ulaşmasını sağlamaktır. Bu platform, yalnızca haber paylaşımını değil, aynı zamanda kullanıcılar arasında açık ve saygılı bir iletişim ortamını da teşvik etmektedir.</p>
                    <p class="font-semibold text-gray-800">A Haber ekibi olarak, sizleri de aramızda görmekten mutluluk duyarız.</p>
                </div>
            </div>

            <!-- Haber Paylaşma Alanı -->
            <div id="submitNews" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-gray-900 mb-6">Haber Paylaşın</h2>
                <div class="bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg mb-4">
                    <p class="font-medium">Anonim olarak haber gönderiyorsunuz. Kimliğiniz gizlidir.</p>
                </div>
                <form id="newsForm" class="space-y-6">
                    <div>
                        <label for="newsTitle" class="block text-gray-700 font-medium mb-2">Başlık (Opsiyonel)</label>
                        <input type="text" id="newsTitle" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200">
                    </div>
                    <div>
                        <label for="newsContent" class="block text-gray-700 font-medium mb-2">Haber İçeriği</label>
                        <textarea id="newsContent" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 h-48 transition duration-200" required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Haberi Gönder</button>
                    <div id="newsMessage" class="mt-4 text-center font-medium"></div>
                </form>
            </div>
            
            <!-- Yayıncılar Listesi -->
            <div id="publishers" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-gray-900 mb-6 border-b-4 border-red-500 pb-2">Yayıncılarımız</h2>
                <ul id="publishersList" class="list-disc list-inside space-y-3 text-gray-700">
                    <!-- Yayıncılar buraya yüklenecek -->
                </ul>
            </div>

            <!-- Yayıncı Paneli -->
            <div id="publisherDashboard" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-gray-900 mb-6 border-b-4 border-red-500 pb-2">Yayıncı Paneli</h2>
                <div id="pendingNewsList" class="space-y-6">
                    <p class="text-gray-500">Bekleyen haberler yükleniyor...</p>
                </div>
            </div>

            <!-- Sohbet Alanı -->
            <div id="chat" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-gray-900 mb-6 border-b-4 border-red-500 pb-2">Canlı Sohbet</h2>
                <div id="chatBox" class="bg-gray-100 h-96 p-4 rounded-lg overflow-y-auto mb-4 border border-gray-300 flex flex-col-reverse">
                    <!-- Sohbet mesajları buraya gelecek -->
                </div>
                <form id="chatForm" class="flex space-x-4">
                    <input type="text" id="chatMessageInput" class="flex-grow p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200" placeholder="Bir mesaj yazın..." required>
                    <button type="submit" class="bg-green-600 text-white font-bold py-4 px-8 rounded-full hover:bg-green-700 transition duration-300 transform hover:scale-105 shadow-lg">Gönder</button>
                </form>
            </div>

            <!-- Ayarlar Menüsü -->
            <div id="settings" class="view p-8 bg-white rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-gray-900 mb-6 border-b-4 border-red-500 pb-2">Hesap Ayarları</h2>
                <div id="settingsMessage" class="mt-4 text-center font-medium"></div>

                <div class="space-y-8">
                    <!-- E-posta Güncelleme Formu -->
                    <form id="updateEmailForm" class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-800">E-posta Adresini Güncelle</h3>
                        <div>
                            <label for="newEmail" class="block text-gray-700 font-medium mb-2">Yeni E-posta</label>
                            <input type="email" id="newEmail" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200" required>
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">E-postayı Güncelle</button>
                    </form>

                    <!-- Şifre Güncelleme Formu -->
                    <form id="updatePasswordForm" class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-800">Şifreyi Güncelle</h3>
                        <div>
                            <label for="newPassword" class="block text-gray-700 font-medium mb-2">Yeni Şifre</label>
                            <input type="password" id="newPassword" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200" required>
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Şifreyi Güncelle</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div id="authModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden flex justify-center items-center p-4 z-[99]">
            <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="authModalTitle" class="text-3xl font-bold text-gray-900"></h2>
                    <button onclick="window.closeAuthModal()" class="text-gray-500 hover:text-gray-900 transition duration-300 transform hover:scale-110">&times;</button>
                </div>
                <form id="authForm" class="space-y-6">
                    <div>
                        <label for="authEmail" class="block text-gray-700 font-medium mb-2">E-posta</label>
                        <input type="email" id="authEmail" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200" required>
                    </div>
                    <div>
                        <label for="authPassword" class="block text-gray-700 font-medium mb-2">Şifre</label>
                        <input type="password" id="authPassword" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200" required>
                    </div>
                    <button type="submit" id="authSubmitBtn" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg"></button>
                    <div id="authMessage" class="mt-4 text-center font-medium"></div>
                </form>
                <div class="mt-6 text-center">
                    <button onclick="window.handleAnonymousLogin()" class="text-blue-600 hover:underline">Anonim olarak devam et</button>
                </div>
            </div>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden flex justify-center items-center p-4 z-[100]">
            <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="messageBoxTitle" class="text-3xl font-bold text-gray-900"></h2>
                    <button onclick="window.closeMessageBox()" class="text-gray-500 hover:text-gray-900 transition duration-300 transform hover:scale-110">&times;</button>
                </div>
                <p id="messageBoxContent" class="text-gray-700 mb-6"></p>
                <button onclick="window.closeMessageBox()" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Tamam</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 text-center p-6 mt-8">
        <p>&copy; 2024 A Haber. Tüm Hakları Saklıdır.</p>
    </footer>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInAnonymously, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateEmail, updatePassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase yapılandırma bilgileri
        const firebaseConfig = {
            apiKey: "AIzaSyD-nr4EJnAmyurBGMJ7JQzqdC4kYaVHoTI",
            authDomain: "esee-240a6.firebaseapp.com",
            projectId: "esee-240a6",
            storageBucket: "esee-240a6.firebasestorage.app",
            messagingSenderId: "1016496897853",
            appId: "1:1016496897853:web:631d976b5e7c2423194f54",
            measurementId: "G-72ZLZ5B9BZ"
        };
        const appId = "1:1016496897853:web:631d976b5e7c2423194f54";
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let currentUserId = null;
        let isPublisher = false;
        let isAuthReady = false;

        // UI elements
        const views = document.querySelectorAll('.view');
        const newsForm = document.getElementById('newsForm');
        const newsMessage = document.getElementById('newsMessage');
        const pendingNewsList = document.getElementById('pendingNewsList');
        const chatForm = document.getElementById('chatForm');
        const chatBox = document.getElementById('chatBox');
        const chatMessageInput = document.getElementById('chatMessageInput');
        const publisherDashboardBtn = document.getElementById('publisherDashboardBtn');
        const authButtons = document.getElementById('authButtons');
        const userProfile = document.getElementById('userProfile');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        const authModal = document.getElementById('authModal');
        const authModalTitle = document.getElementById('authModalTitle');
        const authSubmitBtn = document.getElementById('authSubmitBtn');
        const authEmailInput = document.getElementById('authEmail');
        const authPasswordInput = document.getElementById('authPassword');
        const authMessage = document.getElementById('authMessage');
        const publishersList = document.getElementById('publishersList');
        const updateEmailForm = document.getElementById('updateEmailForm');
        const updatePasswordForm = document.getElementById('updatePasswordForm');
        const settingsMessage = document.getElementById('settingsMessage');
        const messageBox = document.getElementById('messageBox');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const newsFeed = document.getElementById('newsFeed');

        // Firestore collection references
        const newsCollection = collection(db, `artifacts/${appId}/public/data/news`);
        const chatCollection = collection(db, `artifacts/${appId}/public/data/chat`);
        const publishersCollection = collection(db, `artifacts/${appId}/public/data/publishers`);
        const publisherApplicationsCollection = collection(db, `artifacts/${appId}/public/data/publisherApplications`);
        
        // --- UI Functions ---
        window.showView = (viewId) => {
            if (!isAuthReady) return; 
            views.forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
        };

        window.showMessageBox = (title, message) => {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBox.classList.remove('hidden');
        };

        window.closeMessageBox = () => {
            messageBox.classList.add('hidden');
        };

        window.showAuthModal = (mode) => {
            if (mode === 'login') {
                authModalTitle.textContent = 'Giriş Yap';
                authSubmitBtn.textContent = 'Giriş Yap';
                authForm.onsubmit = window.handleLogin;
            } else if (mode === 'signup') {
                authModalTitle.textContent = 'Kayıt Ol';
                authSubmitBtn.textContent = 'Kayıt Ol';
                authForm.onsubmit = window.handleSignup;
            }
            authModal.classList.remove('hidden');
            authMessage.textContent = '';
            authForm.reset();
        };

        window.closeAuthModal = () => {
            authModal.classList.add('hidden');
        };

        // --- Auth Functions ---
        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = authEmailInput.value;
            const password = authPasswordInput.value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                authMessage.textContent = 'Başarıyla giriş yapıldı!';
                authMessage.classList.add('text-green-600');
                window.closeAuthModal();
            } catch (error) {
                console.error("Login Error:", error);
                authMessage.textContent = 'Giriş hatası: ' + error.message;
                authMessage.classList.add('text-red-600');
            }
        };

        window.handleSignup = async (e) => {
            e.preventDefault();
            const email = authEmailInput.value;
            const password = authPasswordInput.value;
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                authMessage.textContent = 'Hesap başarıyla oluşturuldu!';
                authMessage.classList.add('text-green-600');
                window.closeAuthModal();
            } catch (error) {
                console.error("Signup Error:", error);
                authMessage.textContent = 'Kayıt hatası: ' + error.message;
                authMessage.classList.add('text-red-600');
            }
        };

        window.handleAnonymousLogin = async () => {
            try {
                await signInAnonymously(auth);
                window.closeAuthModal();
            } catch (error) {
                console.error("Anonymous login error:", error);
                window.showMessageBox("Hata", "Anonim oturum açılırken bir hata oluştu.");
            }
        };

        window.logout = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Logout error:", error);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                userEmailDisplay.textContent = user.email || 'Anonim Kullanıcı';
                authButtons.classList.add('hidden');
                userProfile.classList.remove('hidden');

                const publisherDocRef = doc(db, `artifacts/${appId}/public/data/publishers/${currentUserId}`);
                const publisherDoc = await getDoc(publisherDocRef);
                isPublisher = publisherDoc.exists();

                if (isPublisher || user.email === 'baranss283@gmail.com') { // For demo purposes, this user is also a publisher
                    publisherDashboardBtn.classList.remove('hidden');
                } else {
                    publisherDashboardBtn.classList.add('hidden');
                }

                console.log("User ID: " + currentUserId);
                isAuthReady = true;
                
                // Load data after auth is ready
                loadNewsFeed();
                loadChatMessages();
                loadPublishers();
                if(isPublisher || user.email === 'baranss283@gmail.com') {
                    loadPendingNews();
                }
                
                window.showView('home');
            } else {
                currentUserId = null;
                isAuthReady = false;
                publisherDashboardBtn.classList.add('hidden');
                authButtons.classList.remove('hidden');
                userProfile.classList.add('hidden');
                isPublisher = false;
                console.log("No user session. Showing login screen.");
                window.showAuthModal('login');
            }
        });

        // --- Data Interaction Functions ---
        newsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) {
                window.showMessageBox("Hata", "Lütfen giriş yapın veya anonim olarak devam edin.");
                return;
            }
            const newsTitle = document.getElementById('newsTitle').value;
            const newsContent = document.getElementById('newsContent').value;
            
            try {
                await addDoc(newsCollection, {
                    title: newsTitle,
                    content: newsContent,
                    status: 'pending',
                    createdAt: new Date(),
                    reporterId: currentUserId
                });
                newsMessage.textContent = 'Haberiniz başarıyla gönderildi ve onay bekliyor.';
                newsMessage.classList.add('text-green-600');
                newsForm.reset();
            } catch (error) {
                console.error("News submission error:", error);
                newsMessage.textContent = 'Haber gönderilirken bir hata oluştu.';
                newsMessage.classList.add('text-red-600');
            }
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) {
                window.showMessageBox("Hata", "Mesaj göndermek için lütfen giriş yapın.");
                return;
            }
            const message = chatMessageInput.value;
            if (!message) return;
            try {
                await addDoc(chatCollection, {
                    message,
                    userId: currentUserId,
                    createdAt: new Date()
                });
                chatMessageInput.value = '';
            } catch (error) {
                console.error("Chat message error:", error);
            }
        });

        updateEmailForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "E-posta güncellemek için giriş yapmalısınız.");
                return;
            }
            const newEmail = document.getElementById('newEmail').value;
            try {
                await updateEmail(auth.currentUser, newEmail);
                settingsMessage.textContent = 'E-posta başarıyla güncellendi.';
                settingsMessage.classList.add('text-green-600');
            } catch (error) {
                settingsMessage.textContent = 'E-posta güncelleme hatası: ' + error.message;
                settingsMessage.classList.add('text-red-600');
                console.error("Email update error:", error);
            }
        });

        updatePasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "Şifre güncellemek için giriş yapmalısınız.");
                return;
            }
            const newPassword = document.getElementById('newPassword').value;
            try {
                await updatePassword(auth.currentUser, newPassword);
                settingsMessage.textContent = 'Şifre başarıyla güncellendi.';
                settingsMessage.classList.add('text-green-600');
            } catch (error) {
                settingsMessage.textContent = 'Şifre güncelleme hatası: ' + error.message;
                settingsMessage.classList.add('text-red-600');
                console.error("Password update error:", error);
            }
        });

        // --- Real-time Listeners ---
        function loadNewsFeed() {
            if (!isAuthReady) return;
            onSnapshot(query(newsCollection, where('status', '==', 'approved')), (snapshot) => {
                newsFeed.innerHTML = '';
                if (snapshot.empty) {
                    newsFeed.innerHTML = '<p class="text-gray-500">Henüz yayınlanmış haber bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const newsData = doc.data();
                        const newsItem = document.createElement('div');
                        newsItem.classList.add('card', 'bg-gray-100', 'p-6', 'rounded-xl', 'shadow-md');
                        newsItem.innerHTML = `
                            <h3 class="text-xl font-bold text-gray-800">${newsData.title || 'Başlıksız Haber'}</h3>
                            <p class="text-gray-600 mt-2">${newsData.content}</p>
                            <p class="text-sm text-gray-400 mt-4">Yayınlanma Tarihi: ${newsData.createdAt?.toDate().toLocaleDateString() || 'Bilinmiyor'}</p>
                        `;
                        newsFeed.appendChild(newsItem);
                    });
                }
            });
        }

        function loadPendingNews() {
            if (!isAuthReady) return;
            onSnapshot(query(newsCollection, where('status', '==', 'pending')), (snapshot) => {
                pendingNewsList.innerHTML = '';
                if (snapshot.empty) {
                    pendingNewsList.innerHTML = '<p class="text-gray-500">Bekleyen haber bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const newsData = doc.data();
                        const newsItem = document.createElement('div');
                        newsItem.classList.add('card', 'bg-gray-100', 'p-4', 'rounded-lg', 'border', 'border-gray-300');
                        newsItem.innerHTML = `
                            <h3 class="text-xl font-semibold">${newsData.title || 'Başlıksız'}</h3>
                            <p class="text-gray-700 mt-2">${newsData.content}</p>
                            <div class="mt-4 space-x-2">
                                <button onclick="window.approveNews('${doc.id}')" class="bg-red-600 text-white px-4 py-2 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105">Onayla</button>
                                <button onclick="window.deleteNews('${doc.id}')" class="bg-gray-600 text-white px-4 py-2 rounded-full hover:bg-gray-700 transition duration-300 transform hover:scale-105">Sil</button>
                            </div>
                        `;
                        pendingNewsList.appendChild(newsItem);
                    });
                }
            });
        }
        
        function loadPublishers() {
            if (!isAuthReady) return;
            onSnapshot(query(publishersCollection), (snapshot) => {
                publishersList.innerHTML = '';
                if (snapshot.empty) {
                    publishersList.innerHTML = '<p class="text-gray-500">Henüz yayıncı bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const publisher = doc.data();
                        const publisherItem = document.createElement('li');
                        publisherItem.classList.add('text-lg', 'font-medium', 'text-gray-800');
                        publisherItem.textContent = publisher.email;
                        publishersList.appendChild(publisherItem);
                    });
                }
            });
        }

        function loadChatMessages() {
            if (!isAuthReady) return;
            onSnapshot(query(chatCollection), (snapshot) => {
                chatBox.innerHTML = '';
                const messages = snapshot.docs.map(doc => doc.data());
                messages.sort((a, b) => a.createdAt.toDate() - b.createdAt.toDate());

                messages.forEach(messageData => {
                    const messageElement = document.createElement('div');
                    const isCurrentUser = messageData.userId === currentUserId;
                    messageElement.classList.add('my-2', 'p-3', 'rounded-lg', 'max-w-xs', 'break-words', 'shadow-md', 'transition-all', 'duration-300', isCurrentUser ? 'self-end bg-blue-600 text-white' : 'self-start bg-gray-300 text-gray-800');
                    messageElement.innerHTML = `
                        <p class="text-xs text-gray-200 mb-1">${isCurrentUser ? 'Siz' : 'Kullanıcı ' + messageData.userId.substring(0, 8)}</p>
                        <p>${messageData.message}</p>
                    `;
                    chatBox.appendChild(messageElement);
                });
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }
        
        // --- Publisher Actions ---
        window.approveNews = async (docId) => {
            if (!isAuthReady || (!isPublisher && auth.currentUser.email !== 'baranss283@gmail.com')) return;
            const newsRef = doc(db, `artifacts/${appId}/public/data/news/${docId}`);
            try {
                await updateDoc(newsRef, {
                    status: 'approved'
                });
                console.log("Haber onaylandı:", docId);
            } catch (error) {
                console.error("Haber onaylama hatası:", error);
            }
        };

        window.deleteNews = async (docId) => {
            if (!isAuthReady || (!isPublisher && auth.currentUser.email !== 'baranss283@gmail.com')) return;
            const newsRef = doc(db, `artifacts/${appId}/public/data/news/${docId}`);
            try {
                await deleteDoc(newsRef);
                console.log("Haber silindi:", docId);
            } catch (error) {
                console.error("Haber silme hatası:", error);
            }
        };
    </script>
</body>
</html>
