<!DOCTYPE html>
<html lang="tr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITACHI NWS</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --secondary-bg: #e9ecef;
            --text-color: #212529;
            --link-color: #0056b3;
            --border-color: #dee2e6;
            --card-bg: #fff;
        }

        .dark {
            --primary-bg: #1a202c;
            --secondary-bg: #2d3748;
            --text-color: #e2e8f0;
            --link-color: #63b3ed;
            --border-color: #4a5568;
            --card-bg: #2d3748;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Open Sans', sans-serif;
        }
        
        .title-font {
            font-family: 'Roboto Slab', serif;
        }
        .view {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .notification {
            background-color: var(--secondary-bg);
            color: var(--text-color);
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideInRight 0.5s forwards;
            min-width: 250px;
            max-width: 350px;
            position: relative;
        }
        .notification.success { background-color: #48bb78; color: #fff; }
        .notification.error { background-color: #f56565; color: #fff; }
        .notification-close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .notification-close-btn:hover {
            opacity: 1;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .bg-primary { background-color: var(--primary-bg); }
        .bg-secondary { background-color: var(--secondary-bg); }
        .text-primary { color: var(--text-color); }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
        .news-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .comment-item {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .news-card-image-container {
            height: 180px;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .news-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease-in-out;
        }
        .news-card:hover .news-card-image {
            transform: scale(1.05);
        }
        
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="bg-red-700 text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <span class="text-4xl font-bold text-white title-font">ITACHI NWS</span>
                <button onclick="window.showView('home')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">ANASAYFA</button>
                <button onclick="window.showView('aboutUs')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">HAKKIMIZDA</button>
                <button onclick="window.showView('submitNews')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">HABER PAYLAŞ</button>
                <button onclick="window.showView('publishers')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">YAYINCILARIMIZ</button>
                <button onclick="window.showView('applyForPublisher')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">YAYINCI BAŞVURUSU</button>
                <button onclick="window.showView('publisherDashboard')" id="publisherDashboardBtn" class="hover:text-gray-300 transition duration-300 transform hover:scale-105 hidden">YAYINCI PANELİ</button>
                <button onclick="window.showView('chat')" class="hover:text-gray-300 transition duration-300 transform hover:scale-105">CANLI SOHBET</button>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button onclick="window.showModal('notificationsModal')" class="relative p-2 rounded-full hover:bg-red-800 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0a3 3 0 11-6 0m6 0v1a3 3 0 11-6 0v-1" />
                        </svg>
                        <span id="notificationBadge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-500 rounded-full hidden">0</span>
                    </button>
                </div>
                <button id="settingsBtn" class="p-2 rounded-full hover:bg-red-800 transition-colors" onclick="window.showModal('settingsModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.527.272 1.042.417 1.573.424 1.343.018 2.578-.544 3.42-1.503zM12 18a6 6 0 100-12 6 6 0 000 12z" />
                    </svg>
                </button>
                <button id="accountsBtn" class="p-2 rounded-full hover:bg-red-800 transition-colors" onclick="window.showModal('accountsModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </button>
            </div>
            <div id="authButtons" class="flex items-center space-x-2">
                <button onclick="window.showAuthModal('login')" class="bg-white text-red-700 font-bold py-2 px-4 rounded-full hover:bg-gray-200 transition duration-300">Giriş Yap</button>
                <button onclick="window.showAuthModal('signup')" class="bg-gray-900 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-800 transition duration-300">Kayıt Ol</button>
            </div>
            <div id="userProfile" class="hidden flex items-center space-x-2">
                <span id="userRoleDisplay" class="bg-gray-700 text-white text-xs font-semibold px-2 py-1 rounded-full"></span>
                <span id="userEmailDisplay" class="text-white font-medium"></span>
                <button onclick="window.logout()" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-600 transition duration-300">Çıkış Yap</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-8 container mx-auto bg-primary">
        
        <!-- View Container -->
        <div id="views" class="space-y-12">

            <!-- Anasayfa -->
            <div id="home" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h1 class="text-4xl font-bold text-primary mb-6 title-font">Son Dakika Haberleri</h1>
                <div id="newsFeed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="text-center text-primary/70">Haberler yükleniyor...</p>
                </div>
            </div>

            <!-- Hakkımızda Bölümü -->
            <div id="aboutUs" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h1 class="text-4xl font-bold text-primary mb-6 border-b-4 border-red-500 pb-2 title-font">Hakkımızda</h1>
                <div class="space-y-6 text-primary leading-relaxed">
                    <p>ITACHI NWS, güncel gelişmeleri en hızlı ve doğru şekilde okuyucularına ulaştırmayı hedefleyen modern bir haber ajansı simülasyonudur. Şeffaflık, tarafsızlık ve güvenilirlik ilkeleriyle yola çıkarak, toplumsal olaylara, teknolojiye, ekonomiye ve kültüre dair en önemli haberleri derliyoruz.</p>
                    <p>Platformumuz, bağımsız gazetecilerin ve vatandaş muhabirlerinin sesini duyurmasına olanak tanır. Kullanıcılarımız, sisteme anonim olarak haber gönderimi yapabilir veya yayıncı statüsü alarak onaylanmış haberleri yayınlayabilir. Her haber, yayınlanmadan önce editör ekibimiz tarafından titizlikle incelenir ve teyit edilir.</p>
                    <p>Misyonumuz, bilgiye erişimi kolaylaştırmak ve herkesin doğru habere ulaşmasını sağlamaktır. Bu platform, yalnızca haber paylaşımını değil, aynı zamanda kullanıcılar arasında açık ve saygılı bir iletişim ortamını da teşvik etmektedir.</p>
                    <p class="font-semibold text-primary">ITACHI NWS ekibi olarak, sizleri de aramızda görmekten mutluluk duyarız.</p>
                </div>
            </div>

            <!-- Haber Paylaşma Alanı -->
            <div id="submitNews" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 title-font">Haber Paylaşın</h2>
                <div class="bg-red-900 border border-red-700 text-red-200 p-4 rounded-lg mb-4">
                    <p class="font-medium">Anonim olarak haber gönderiyorsunuz. Kimliğiniz gizlidir.</p>
                </div>
                <form id="newsForm" class="space-y-6">
                    <div>
                        <label for="newsTitle" class="block text-primary font-medium mb-2">Başlık (Opsiyonel)</label>
                        <input type="text" id="newsTitle" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-secondary text-primary border-border-color">
                    </div>
                    <div>
                        <label for="newsContent" class="block text-primary font-medium mb-2">Haber İçeriği</label>
                        <textarea type="text" id="newsContent" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 h-48 transition duration-200 bg-secondary text-primary border-border-color" required></textarea>
                    </div>
                    <div>
                        <label for="newsFile" class="block text-primary font-medium mb-2">Resim Yükle (Opsiyonel, sadece jpg/png)</label>
                        <input type="file" id="newsFile" accept="image/jpeg, image/png, image/gif" class="w-full text-primary">
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Haberi Gönder</button>
                    <div id="newsMessage" class="mt-4 text-center font-medium"></div>
                </form>
            </div>
            
            <!-- Yayıncı Başvuru Alanı -->
            <div id="applyForPublisher" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 title-font">Yayıncı Olarak Başvuru</h2>
                <div class="bg-yellow-900 border border-yellow-700 text-yellow-200 p-4 rounded-lg mb-4">
                    <p class="font-medium">Başvurunuz, bir yönetici tarafından incelenecek ve onaylandığında rolünüz otomatik olarak değişecektir.</p>
                </div>
                <p class="text-primary mb-4">Lütfen aşağıdaki soruları yanıtlayarak yayıncı olma isteğinizi bize iletin.</p>
                <form id="publisherApplicationForm" class="space-y-6">
                    <div>
                        <label for="q1" class="block text-primary font-medium mb-2">1. Neden ITACHI NWS platformunda yayıncı olmak istiyorsunuz?</label>
                        <textarea id="q1" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 h-24 bg-secondary text-primary border-border-color" required></textarea>
                    </div>
                    <div>
                        <label for="q2" class="block text-primary font-medium mb-2">2. Haber yazma veya medya alanında daha önce deneyiminiz oldu mu?</label>
                        <textarea id="q2" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 h-24 bg-secondary text-primary border-border-color" required></textarea>
                    </div>
                    <div>
                        <label for="q3" class="block text-primary font-medium mb-2">3. Başvurduğunuz e-posta adresini doğrulayın.</label>
                        <input type="email" id="q3" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-secondary text-primary border-border-color" required>
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Başvuruyu Gönder</button>
                    <div id="applicationMessage" class="mt-4 text-center font-medium"></div>
                </form>
            </div>
            
            <!-- Yayıncılar Listesi -->
            <div id="publishers" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 border-b-4 border-red-500 pb-2 title-font">Yayıncılarımız</h2>
                <ul id="publishersList" class="list-disc list-inside space-y-3 text-primary">
                    <!-- Yayıncılar buraya yüklenecek -->
                </ul>
            </div>

            <!-- Yayıncı Paneli -->
            <div id="publisherDashboard" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 border-b-4 border-red-500 pb-2 title-font">Yayıncı Paneli</h2>
                <div class="space-y-8">
                    <!-- Bekleyen Haberler -->
                    <div>
                        <h3 class="text-2xl font-bold text-primary mb-4">Bekleyen Haberler</h3>
                        <div id="pendingNewsList" class="space-y-6">
                            <p class="text-primary/70">Bekleyen haberler yükleniyor...</p>
                        </div>
                    </div>
                    <!-- Yayıncı Başvuruları -->
                    <div>
                        <h3 class="text-2xl font-bold text-primary mb-4">Yayıncı Başvuruları</h3>
                        <div id="publisherApplicationsList" class="space-y-6">
                            <p class="text-primary/70">Bekleyen başvuru bulunmuyor.</p>
                        </div>
                    </div>
                    <!-- Yeni Yayıncı Oluştur -->
                    <div>
                        <h3 class="text-2xl font-bold text-primary mb-4">Yeni Yayıncı Oluştur</h3>
                        <p class="text-primary/70 mb-4">E-posta ve şifre ile yeni bir yayıncı hesabı oluşturun.</p>
                        <form id="createPublisherForm" class="space-y-4">
                            <div>
                                <label for="newPublisherEmail" class="block text-primary font-medium mb-2">Yeni Yayıncı E-postası</label>
                                <input type="email" id="newPublisherEmail" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-secondary text-primary border-border-color" required>
                            </div>
                            <div>
                                <label for="newPublisherPassword" class="block text-primary font-medium mb-2">Yeni Yayıncı Şifresi</label>
                                <input type="password" id="newPublisherPassword" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-secondary text-primary border-border-color" required minlength="6">
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-full hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-lg">Yayıncı Oluştur</button>
                            <div id="createPublisherMessage" class="mt-4 text-center font-medium"></div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Sohbet Alanı -->
            <div id="chat" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 border-b-4 border-red-500 pb-2 title-font">Canlı Sohbet</h2>
                <div id="chatBox" class="bg-primary h-96 p-4 rounded-lg overflow-y-auto mb-4 border border-border-color flex flex-col-reverse">
                    <!-- Sohbet mesajları buraya gelecek -->
                </div>
                <form id="chatForm" class="flex space-x-4">
                    <input type="text" id="chatMessageInput" class="flex-grow p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-secondary text-primary border-border-color" placeholder="Bir mesaj yazın..." required>
                    <button type="submit" class="bg-green-600 text-white font-bold py-4 px-8 rounded-full hover:bg-green-700 transition duration-300 transform hover:scale-105 shadow-lg">Gönder</button>
                </form>
            </div>

            <!-- Ayarlar Menüsü -->
            <div id="settings" class="view p-8 card rounded-2xl shadow-xl hidden">
                <h2 class="text-3xl font-semibold text-primary mb-6 border-b-4 border-red-500 pb-2 title-font">Hesap Ayarları</h2>
                <div id="settingsMessage" class="mt-4 text-center font-medium"></div>

                <div class="space-y-8">
                    <!-- E-posta Güncelleme Formu -->
                    <form id="updateEmailForm" class="space-y-4">
                        <h3 class="text-xl font-semibold text-primary">E-posta Adresini Güncelle</h3>
                        <div>
                            <label for="newEmail" class="block text-primary font-medium mb-2">Yeni E-posta</label>
                            <input type="email" id="newEmail" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-secondary text-primary border-border-color" required>
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">E-postayı Güncelle</button>
                    </form>

                    <!-- Şifre Güncelleme Formu -->
                    <form id="updatePasswordForm" class="space-y-4">
                        <h3 class="text-xl font-semibold text-primary">Şifreyi Güncelle</h3>
                        <div>
                            <label for="newPassword" class="block text-primary font-medium mb-2">Yeni Şifre</label>
                            <input type="password" id="newPassword" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-secondary text-primary border-border-color" required minlength="6">
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Şifreyi Güncelle</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div id="authModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden flex justify-center items-center p-4 z-[99]">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="authModalTitle" class="text-3xl font-bold text-gray-100 title-font"></h2>
                    <button onclick="window.closeAuthModal()" class="text-gray-400 hover:text-gray-100 transition duration-300 transform hover:scale-110">&times;</button>
                </div>
                <form id="authForm" class="space-y-6">
                    <div>
                        <label for="authEmail" class="block text-gray-300 font-medium mb-2">E-posta</label>
                        <input type="email" id="authEmail" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-gray-900 text-white border-gray-700" required>
                    </div>
                    <div>
                        <label for="authPassword" class="block text-gray-300 font-medium mb-2">Şifre</label>
                        <input type="password" id="authPassword" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-200 bg-gray-900 text-white border-gray-700" required minlength="6">
                    </div>
                    <button type="submit" id="authSubmitBtn" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg"></button>
                    <div id="authMessage" class="mt-4 text-center font-medium"></div>
                </form>
            </div>
        </div>
        
        <!-- News Detail Modal -->
        <div id="newsDetailModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden flex justify-center items-center p-4 z-[99]">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-2xl overflow-y-auto max-h-[90vh]">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="newsDetailTitle" class="text-3xl font-bold text-gray-100 title-font"></h2>
                    <button onclick="window.closeModal('newsDetailModal')" class="text-gray-400 hover:text-gray-100 transition duration-300 transform hover:scale-110">&times;</button>
                </div>
                <img id="newsDetailImage" class="news-image hidden" alt="Haber Görseli">
                <p id="newsDetailContent" class="text-gray-300 mb-6 text-lg leading-relaxed"></p>

                <!-- Yorumlar Bölümü -->
                <div class="mt-8 border-t-2 border-red-500 pt-6">
                    <h3 class="text-2xl font-bold text-gray-100 mb-4 title-font">Yorumlar</h3>
                    <div id="commentsList" class="space-y-4 max-h-60 overflow-y-auto mb-4">
                        <!-- Yorumlar buraya yüklenecek -->
                    </div>
                    
                    <!-- Yorum Ekleme Formu -->
                    <form id="commentForm" class="flex items-end space-x-4">
                        <textarea id="commentInput" class="flex-grow p-3 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Bir yorum yazın..." required></textarea>
                        <button type="submit" class="bg-red-600 text-white font-bold py-3 px-6 rounded-full hover:bg-red-700 transition duration-300">Gönder</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden flex justify-center items-center p-4 z-[100]">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-sm">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="messageBoxTitle" class="text-3xl font-bold text-gray-100 title-font"></h2>
                    <button onclick="window.closeMessageBox()" class="text-gray-400 hover:text-gray-100 transition duration-300 transform hover:scale-110">&times;</button>
                </div>
                <p id="messageBoxContent" class="text-gray-300 mb-6"></p>
                <button onclick="window.closeMessageBox()" class="w-full bg-red-600 text-white font-bold py-4 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105 shadow-lg">Tamam</button>
            </div>
        </div>
    </main>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden fixed inset-0 flex items-center justify-center p-4 z-50">
        <div class="card w-full max-w-md p-6 rounded-xl shadow-lg relative">
            <button id="closeSettingsBtn" class="absolute top-4 right-4 text-xl text-primary">&times;</button>
            <h3 class="text-xl font-bold mb-4 text-primary title-font">Ayarlar</h3>
            <div class="mb-4">
                <label class="block text-primary mb-2">Tema Seçimi</label>
                <select id="themeSelect" class="w-full p-2 rounded-lg bg-secondary text-primary border border-border-color">
                    <option value="light">Açık Tema</option>
                    <option value="dark">Koyu Tema</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Accounts Modal -->
    <div id="accountsModal" class="modal-overlay hidden fixed inset-0 flex items-center justify-center p-4 z-50">
        <div class="card w-full max-w-lg p-6 rounded-xl shadow-lg relative">
            <button id="closeAccountsBtn" class="absolute top-4 right-4 text-xl text-primary">&times;</button>
            <h3 class="text-xl font-bold mb-4 text-primary title-font">Kullanıcı Yönetimi</h3>
            <p id="userIdDisplay" class="text-sm mb-4 break-all text-primary/70">Kullanıcı Kimliği: Yükleniyor...</p>
            <div class="mb-4">
                <h4 class="font-semibold mb-2 text-primary">Kullanıcı Listesi</h4>
                <div id="usersList" class="space-y-2 max-h-60 overflow-y-auto">
                    <p class="text-center text-primary/70">Kullanıcılar yükleniyor...</p>
                </div>
            </div>
             <p id="messageBoxModal" class="text-sm text-center mt-4 hidden p-2 rounded-md"></p>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal-overlay hidden fixed inset-0 flex items-center justify-center p-4 z-50">
        <div class="card w-full max-w-md p-6 rounded-xl shadow-lg relative">
            <button onclick="window.closeModal('notificationsModal')" class="absolute top-4 right-4 text-xl text-primary">&times;</button>
            <h3 class="text-xl font-bold mb-4 text-primary title-font">Bildirimler</h3>
            <div id="notificationList" class="space-y-4 max-h-80 overflow-y-auto">
                <p class="text-primary/70">Henüz bildiriminiz yok.</p>
            </div>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Footer -->
    <footer class="bg-red-700 text-gray-200 text-center p-6 mt-8">
        <p>&copy; 2024 ITACHI NWS. Tüm Hakları Saklıdır.</p>
    </footer>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateEmail, updatePassword, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Firebase configuration and variables
        const __app_id = "itachi-haber-v1";
        const __firebase_config = `{
            "apiKey": "AIzaSyD-nr4EJnAmyurBGMJ7JQzqdC4kYaVHoTI",
            "authDomain": "esee-240a6.firebaseapp.com",
            "projectId": "esee-240a6",
            "storageBucket": "esee-240a6.appspot.com",
            "messagingSenderId": "1016496897853",
            "appId": "1:1016496897853:web:631d976b5e7c2423194f54",
            "measurementId": "G-72ZLZ5B9BZ"
        }`;
        const __initial_auth_token = "";

        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        let currentUserId = null;
        let isPublisher = false;
        let isAuthReady = false;
        let notificationsCount = 0;

        // UI elements
        const body = document.body;
        const views = document.querySelectorAll('.view');
        const newsForm = document.getElementById('newsForm');
        const newsMessage = document.getElementById('newsMessage');
        const pendingNewsList = document.getElementById('pendingNewsList');
        const chatForm = document.getElementById('chatForm');
        const chatBox = document.getElementById('chatBox');
        const chatMessageInput = document.getElementById('chatMessageInput');
        const publisherDashboardBtn = document.getElementById('publisherDashboardBtn');
        const authButtons = document.getElementById('authButtons');
        const userProfile = document.getElementById('userProfile');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        const userRoleDisplay = document.getElementById('userRoleDisplay');
        const authModal = document.getElementById('authModal');
        const authModalTitle = document.getElementById('authModalTitle');
        const authSubmitBtn = document.getElementById('authSubmitBtn');
        const authEmailInput = document.getElementById('authEmail');
        const authPasswordInput = document.getElementById('authPassword');
        const authMessage = document.getElementById('authMessage');
        const publishersList = document.getElementById('publishersList');
        const updateEmailForm = document.getElementById('updateEmailForm');
        const updatePasswordForm = document.getElementById('updatePasswordForm');
        const settingsMessage = document.getElementById('settingsMessage');
        const messageBox = document.getElementById('messageBox');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const newsFeed = document.getElementById('newsFeed');
        const publisherApplicationForm = document.getElementById('publisherApplicationForm');
        const applicationMessage = document.getElementById('applicationMessage');
        const publisherApplicationsList = document.getElementById('publisherApplicationsList');
        const createPublisherForm = document.getElementById('createPublisherForm');
        const createPublisherMessage = document.getElementById('createPublisherMessage');
        const newsFileInput = document.getElementById('newsFile');
        const notificationContainer = document.getElementById('notificationContainer');
        const settingsModal = document.getElementById('settingsModal');
        const accountsModal = document.getElementById('accountsModal');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const closeAccountsBtn = document.getElementById('closeAccountsBtn');
        const themeSelect = document.getElementById('themeSelect');
        const usersList = document.getElementById('usersList');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const messageBoxModal = document.getElementById('messageBoxModal');
        const notificationsModal = document.getElementById('notificationsModal');
        const notificationList = document.getElementById('notificationList');
        const notificationBadge = document.getElementById('notificationBadge');

        // News Detail Modal elements
        const newsDetailModal = document.getElementById('newsDetailModal');
        const newsDetailTitle = document.getElementById('newsDetailTitle');
        const newsDetailImage = document.getElementById('newsDetailImage');
        const newsDetailContent = document.getElementById('newsDetailContent');
        const commentsList = document.getElementById('commentsList');
        const commentForm = document.getElementById('commentForm');
        const commentInput = document.getElementById('commentInput');

        // Firestore collection references
        const newsCollection = collection(db, `artifacts/${appId}/public/data/news`);
        const chatCollection = collection(db, `artifacts/${appId}/public/data/chat`);
        const publishersCollection = collection(db, `artifacts/${appId}/public/data/publishers`);
        const publisherApplicationsCollection = collection(db, `artifacts/${appId}/public/data/publisherApplications`);
        const usersCollection = collection(db, `artifacts/${appId}/public/data/users`);
        const notificationsCollection = collection(db, `artifacts/${appId}/users/notifications`);
        
        const fictionalNewsData = [
            {
                id: '1',
                title: 'Konuşan Ağaç Gözcüleri Şaşırttı',
                content: 'Bilinmeyen bir bölgede keşfedilen ve "Konuşan Ağaç" adı verilen meşe ağacı, bilim dünyasında büyük bir heyecan yarattı. Ağaç, ziyaretçilere bilmece sormasıyla gündeme geldi. İlk bilmecenin cevabını bulan kişi, "Hayatın Anlamı" konulu bir kitap yazacağını söyledi.',
                imageUrl: 'https://placehold.co/600x400/2a2e34/e3e3e3?text=Konusan+Agac'
            },
            {
                id: '2',
                title: 'Uçan Simitler Şehri Ele Geçirdi',
                content: 'Sabah saatlerinde gökyüzünde beliren devasa simitler, şehri sevinçle karşılanan bir sürprizle doldurdu. Herkes bu lezzetli fenomenin arkasındaki gizemi merak ediyor. Belediye başkanı "Simit krizi değil, simit şöleni yaşıyoruz!" diyerek halkı sakinleştirmeye çalıştı.',
                imageUrl: 'https://placehold.co/600x400/2a2e34/e3e3e3?text=Ucan+Simit'
            },
            {
                id: '3',
                title: 'Kedi, Daire Başkanı Oldu',
                content: 'Yerel bir belediyede çalışan ve adı "Bıyık" olan bir kedi, olağanüstü yönetim becerileri sayesinde yeni Daire Başkanı olarak atandı. Ofis içi hiyerarşiyi tamamen değiştiren Bıyık, ilk kararnamesiyle mesai saatlerine "zorunlu şekerleme molası" getirdi.',
                imageUrl: 'https://placehold.co/600x400/2a2e34/e3e3e3?text=Kedi+Baskan'
            },
            {
                id: '4',
                title: 'Işınlanma Teknolojisi Yanlışlıkla Tost Makinesi Yarattı',
                content: 'Evrensel Ulaşım Araştırma Laboratuvarı, üzerinde çalıştığı ışınlanma projesinin bir sonucu olarak yanlışlıkla mükemmel bir tost makinesi üretti. Araştırma ekibi, "Hedefimiz uzaydı ama geldiğimiz nokta çok daha lezzetli oldu," açıklamasında bulundu.',
                imageUrl: 'https://placehold.co/600x400/2a2e34/e3e3e3?text=Işinlanma+Hatasi'
            },
            {
                id: '5',
                title: 'Ay, Gece Yarıları Mor Renge Bürünüyor',
                content: 'Gökbilimciler, son birkaç aydır Ay\'ın belirli gecelerde mor renge dönüştüğünü gözlemlediklerini bildirdi. Bu kozmik olayın nedeni henüz bilinmiyor ancak halk arasında "Ay\'ın Sürprizi" olarak adlandırıldı.',
                imageUrl: 'https://placehold.co/600x400/2a2e34/e3e3e3?text=Mor+Ay'
            }
        ];
        
        // --- UI Functions ---
        window.showView = (viewId) => {
            if (!isAuthReady) return; 
            views.forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
        };

        window.showMessageBox = (title, message) => {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBox.classList.remove('hidden');
        };

        window.closeMessageBox = () => {
            messageBox.classList.add('hidden');
        };
        
        window.showModal = (modalId) => {
            document.getElementById(modalId).classList.remove('hidden');
            if (modalId === 'notificationsModal') {
                updateNotificationBadge(0);
                const listItems = notificationList.querySelectorAll('.notification-item');
                listItems.forEach(item => item.classList.add('read'));
            }
        };

        window.closeModal = (modalId) => {
            document.getElementById(modalId).classList.add('hidden');
        };

        window.showNotification = async (message, type = 'info') => {
            const notification = document.createElement('div');
            notification.classList.add('notification', type);
            notification.innerHTML = `
                <p class="font-semibold">${message}</p>
                <span class="notification-close-btn">&times;</span>
            `;
            notificationContainer.appendChild(notification);
            
            notification.querySelector('.notification-close-btn').addEventListener('click', () => {
                notification.remove();
            });

            setTimeout(() => {
                notification.remove();
            }, 5000);
            
            if (currentUserId) {
                try {
                    await addDoc(collection(db, `artifacts/${appId}/users/${currentUserId}/notifications`), {
                        message: message,
                        type: type,
                        timestamp: new Date(),
                        isRead: false
                    });
                } catch (error) {
                    console.error("Bildirim kaydedilirken hata oluştu:", error);
                }
            }
        };

        window.showAuthModal = (mode) => {
            if (mode === 'login') {
                authModalTitle.textContent = 'Giriş Yap';
                authSubmitBtn.textContent = 'Giriş Yap';
                authForm.onsubmit = window.handleLogin;
            } else if (mode === 'signup') {
                authModalTitle.textContent = 'Kayıt Ol';
                authSubmitBtn.textContent = 'Kayıt Ol';
                authForm.onsubmit = window.handleSignup;
            }
            authModal.classList.remove('hidden');
            authMessage.textContent = '';
            authForm.reset();
        };

        window.closeAuthModal = () => {
            authModal.classList.add('hidden');
        };
        
        function showModalMessage(message, type = 'info') {
            messageBoxModal.textContent = message;
            messageBoxModal.className = `text-sm text-center mt-4 p-2 rounded-md ${type === 'success' ? 'bg-green-500/20 text-green-500' : 'bg-red-500/20 text-red-500'}`;
            messageBoxModal.classList.remove('hidden');
            setTimeout(() => {
                messageBoxModal.classList.add('hidden');
            }, 3000);
        }

        window.openNewsDetail = (newsData) => {
            newsDetailTitle.textContent = newsData.title;
            newsDetailContent.textContent = newsData.content;
            newsDetailImage.src = newsData.imageUrl || 'https://placehold.co/600x400/2a2e34/e3e3e3?text=ITACHI+NWS';
            newsDetailImage.classList.remove('hidden');
            newsDetailModal.dataset.newsId = newsData.id;
            window.showModal('newsDetailModal');
            loadComments(newsData.id);
        };
        
        function updateNotificationBadge(count) {
            notificationsCount = count;
            if (count > 0) {
                notificationBadge.textContent = count;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        // --- Persistent Settings ---
        function loadSettings() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                body.classList.remove('light', 'dark');
                body.classList.add(savedTheme);
                themeSelect.value = savedTheme;
            }
        }

        function saveSettings() {
            localStorage.setItem('theme', themeSelect.value);
        }

        // --- Auth Functions ---
        async function authenticateUser() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } catch (error) {
                    console.error("Custom token sign-in error:", error);
                }
            }
        }

        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = authEmailInput.value;
            const password = authPasswordInput.value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                authMessage.textContent = 'Başarıyla giriş yapıldı!';
                authMessage.classList.add('text-green-600');
                window.closeAuthModal();
            } catch (error) {
                console.error("Login Error:", error);
                authMessage.textContent = 'Giriş hatası: ' + error.message;
                authMessage.classList.add('text-red-600');
            }
        };

        window.handleSignup = async (e) => {
            e.preventDefault();
            const email = authEmailInput.value;
            const password = authPasswordInput.value;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const newUserId = userCredential.user.uid;
                await setDoc(doc(usersCollection, newUserId), { email, role: 'Okur' });
                
                authMessage.textContent = 'Hesap başarıyla oluşturuldu!';
                authMessage.classList.add('text-green-600');
                window.closeAuthModal();
                window.showNotification('Hesabınız başarıyla oluşturuldu!', 'success');
            } catch (error) {
                console.error("Signup Error:", error);
                authMessage.textContent = 'Kayıt hatası: ' + error.message;
                authMessage.classList.add('text-red-600');
            }
        };

        window.logout = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Logout error:", error);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                authButtons.classList.add('hidden');
                userProfile.classList.remove('hidden');

                const userDocRef = doc(usersCollection, currentUserId);
                const userDoc = await getDoc(userDocRef);
                
                let userRole = 'Okur';
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userRole = userData.role;
                } else {
                    await setDoc(userDocRef, { email: user.email, role: 'Okur' }, { merge: true });
                }

                userEmailDisplay.textContent = user.email || user.uid;
                userRoleDisplay.textContent = userRole;

                isPublisher = userRole === 'Yayıncı' || userRole === 'Yönetici';

                if (publisherDashboardBtn) {
                     if (isPublisher || user.email === 'baranss283@gmail.com') {
                         publisherDashboardBtn.classList.remove('hidden');
                     } else {
                         publisherDashboardBtn.classList.add('hidden');
                     }
                 }
                 loadUserNotifications();
            } else {
                currentUserId = null;
                isPublisher = false;
                if(publisherDashboardBtn) {
                     publisherDashboardBtn.classList.add('hidden');
                }
                authButtons.classList.remove('hidden');
                userProfile.classList.add('hidden');
                updateNotificationBadge(0);
                notificationList.innerHTML = `<p class="text-primary/70">Henüz bildiriminiz yok.</p>`;
            }
            isAuthReady = true;
            if (isAuthReady) {
                loadNewsFeed();
                loadChatMessages();
                loadPublishers();
                loadUsers();
                if (isPublisher || auth.currentUser?.email === 'baranss283@gmail.com') {
                    loadPendingNews();
                    loadPublisherApplications();
                }
            }
        });

        // --- Data Interaction Functions ---
        newsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) {
                window.showMessageBox("Hata", "Lütfen giriş yapın veya anonim olarak devam edin.");
                return;
            }
            const newsTitle = document.getElementById('newsTitle').value;
            const newsContent = document.getElementById('newsContent').value;
            const file = newsFileInput.files[0];
            let fileUrl = null;

            try {
                if (file) {
                    const storageRef = ref(storage, `news-files/${file.name}`);
                    await uploadBytes(storageRef, file);
                    fileUrl = await getDownloadURL(storageRef);
                }

                await addDoc(newsCollection, {
                    title: newsTitle,
                    content: newsContent,
                    status: 'pending',
                    createdAt: new Date(),
                    reporterId: currentUserId,
                    fileUrl: fileUrl,
                    fileName: file ? file.name : null
                });
                newsMessage.textContent = 'Haberiniz başarıyla gönderildi ve onay bekliyor.';
                newsMessage.classList.add('text-green-600');
                newsForm.reset();
            } catch (error) {
                console.error("News submission error:", error);
                newsMessage.textContent = 'Haber gönderilirken bir hata oluştu: ' + error.message;
                newsMessage.classList.add('text-red-600');
            }
        });

        publisherApplicationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "Yayıncı başvurusu yapmak için giriş yapmalısınız.");
                return;
            }
            const q1 = document.getElementById('q1').value;
            const q2 = document.getElementById('q2').value;
            const q3 = document.getElementById('q3').value;
            const userEmail = auth.currentUser.email;

            if (q3 !== userEmail) {
                 applicationMessage.textContent = 'Lütfen kendi e-posta adresinizi girin.';
                 applicationMessage.classList.add('text-red-600');
                 return;
            }

            try {
                await addDoc(publisherApplicationsCollection, {
                    userId: auth.currentUser.uid,
                    email: userEmail,
                    question1: q1,
                    question2: q2,
                    question3: q3,
                    status: 'pending',
                    appliedAt: new Date()
                });
                applicationMessage.textContent = 'Başvurunuz başarıyla gönderildi!';
                applicationMessage.classList.add('text-green-600');
                publisherApplicationForm.reset();
            } catch (error) {
                console.error("Publisher application error:", error);
                applicationMessage.textContent = 'Başvuru gönderilirken bir hata oluştu.';
                applicationMessage.classList.add('text-red-600');
            }
        });
        
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "Mesaj göndermek için lütfen giriş yapın.");
                return;
            }
            const message = chatMessageInput.value;
            if (!message) return;
            try {
                await addDoc(chatCollection, {
                    message,
                    userId: currentUserId,
                    createdAt: new Date()
                });
                chatMessageInput.value = '';
            } catch (error) {
                console.error("Chat message error:", error);
            }
        });

        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "Yorum yapmak için giriş yapmalısınız.");
                return;
            }
            const newsId = newsDetailModal.dataset.newsId;
            const commentText = commentInput.value;

            if (!commentText || !newsId) return;

            try {
                const commentsCollectionRef = collection(db, `artifacts/${appId}/public/data/news/${newsId}/comments`);
                await addDoc(commentsCollectionRef, {
                    comment: commentText,
                    userId: currentUserId,
                    timestamp: new Date()
                });
                commentInput.value = '';
                window.showNotification('Yorumunuz gönderildi!', 'success');
            } catch (error) {
                console.error("Yorum gönderme hatası:", error);
                window.showNotification('Yorum gönderilirken bir hata oluştu.', 'error');
            }
        });

        updateEmailForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "E-posta güncellemek için giriş yapmalısınız.");
                return;
            }
            const newEmail = document.getElementById('newEmail').value;
            try {
                await updateEmail(auth.currentUser, newEmail);
                await updateDoc(doc(usersCollection, currentUserId), { email: newEmail });
                settingsMessage.textContent = 'E-posta başarıyla güncellendi.';
                settingsMessage.classList.add('text-green-600');
            } catch (error) {
                settingsMessage.textContent = 'E-posta güncelleme hatası: ' + error.message;
                settingsMessage.classList.add('text-red-600');
                console.error("Email update error:", error);
            }
        });

        updatePasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || !auth.currentUser) {
                window.showMessageBox("Hata", "Şifre güncellemek için giriş yapmalısınız.");
                return;
            }
            const newPassword = document.getElementById('newPassword').value;
            if (newPassword.length < 6) {
                settingsMessage.textContent = 'Şifre en az 6 karakter olmalıdır.';
                settingsMessage.classList.add('text-red-600');
                return;
            }
            try {
                await updatePassword(auth.currentUser, newPassword);
                settingsMessage.textContent = 'Şifre başarıyla güncellendi.';
                settingsMessage.classList.add('text-green-600');
            } catch (error) {
                settingsMessage.textContent = 'Şifre güncelleme hatası: ' + error.message;
                settingsMessage.classList.add('text-red-600');
                console.error("Password update error:", error);
            }
        });

        createPublisherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady || auth.currentUser.email !== 'baranss283@gmail.com') {
                window.showMessageBox("Yetki Hatası", "Bu işlemi gerçekleştirmek için admin olmalısınız.");
                return;
            }
            const newPublisherEmail = document.getElementById('newPublisherEmail').value;
            const newPublisherPassword = document.getElementById('newPublisherPassword').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, newPublisherEmail, newPublisherPassword);
                const newUserId = userCredential.user.uid;
                
                await setDoc(doc(publishersCollection, newUserId), {
                    email: newPublisherEmail,
                    appliedAt: new Date(),
                    status: 'approved'
                });
                await setDoc(doc(usersCollection, newUserId), { email: newPublisherEmail, role: 'Yayıncı' });
                
                createPublisherMessage.textContent = 'Yeni yayıncı başarıyla oluşturuldu!';
                createPublisherMessage.classList.add('text-green-600');
                createPublisherForm.reset();
            } catch (error) {
                createPublisherMessage.textContent = 'Yayıncı oluşturulurken bir hata oluştu: ' + error.message;
                createPublisherMessage.classList.add('text-red-600');
                console.error("Create publisher error:", error);
            }
        });

        // --- Real-time Listeners ---
        function loadNewsFeed(newsItems) {
            newsFeed.innerHTML = '';
            if (!newsItems || newsItems.length === 0) {
                newsFeed.innerHTML = '<p class="text-center text-primary/70">Henüz yayınlanmış haber bulunmuyor.</p>';
            } else {
                newsItems.forEach(newsData => {
                    const newsItem = document.createElement('div');
                    newsItem.classList.add('news-card', 'card', 'p-6', 'rounded-xl', 'shadow-md', 'cursor-pointer');
                    newsItem.onclick = () => window.openNewsDetail(newsData);
                    
                    const imageUrl = newsData.imageUrl || 'https://placehold.co/600x400/2a2e34/e3e3e3?text=ITACHI+NWS';

                    newsItem.innerHTML = `
                        <div class="news-card-image-container">
                            <img src="${imageUrl}" alt="${newsData.title || 'Haber Görseli'}" class="news-card-image">
                        </div>
                        <h3 class="text-xl font-bold text-primary mt-4 title-font">${newsData.title || 'Başlıksız Haber'}</h3>
                        <p class="text-primary/70 mt-2 text-sm">${newsData.content.substring(0, 100)}...</p>
                    `;
                    newsFeed.appendChild(newsItem);
                });
            }
        }
        
        function loadPendingNews() {
            if (!isAuthReady) return;
            onSnapshot(query(newsCollection, where('status', '==', 'pending')), (snapshot) => {
                pendingNewsList.innerHTML = '';
                if (snapshot.empty) {
                    pendingNewsList.innerHTML = '<p class="text-primary/70">Bekleyen haber bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const newsData = doc.data();
                        const newsItem = document.createElement('div');
                        newsItem.classList.add('card', 'p-4', 'rounded-lg', 'border', 'border-border-color');
                        
                        let fileHtml = '';
                        if (newsData.fileUrl) {
                             const isImage = newsData.fileUrl.match(/\.(jpeg|jpg|gif|png)$/i);
                             if (isImage) {
                                  fileHtml = `<img src="${newsData.fileUrl}" alt="Haber Görseli" class="news-image mt-4">`;
                             } else {
                                  fileHtml = `<a href="${newsData.fileUrl}" target="_blank" class="text-blue-400 hover:underline">Ekli Dosya: ${newsData.fileName}</a>`;
                             }
                        }

                        newsItem.innerHTML = `
                            <h3 class="text-xl font-semibold text-primary title-font">${newsData.title || 'Başlıksız'}</h3>
                            <p class="text-primary/70 mt-2">${newsData.content}</p>
                            ${fileHtml}
                            <div class="mt-4 space-x-2">
                                <button onclick="window.approveNews('${doc.id}')" class="bg-red-600 text-white px-4 py-2 rounded-full hover:bg-red-700 transition duration-300 transform hover:scale-105">Onayla</button>
                                <button onclick="window.deleteNews('${doc.id}')" class="bg-gray-600 text-white px-4 py-2 rounded-full hover:bg-gray-700 transition duration-300 transform hover:scale-105">Sil</button>
                            </div>
                        `;
                        pendingNewsList.appendChild(newsItem);
                    });
                }
            });
        }
        
        function loadPublishers() {
            if (!isAuthReady) return;
            onSnapshot(query(publishersCollection), (snapshot) => {
                publishersList.innerHTML = '';
                if (snapshot.empty) {
                    publishersList.innerHTML = '<p class="text-primary/70">Henüz yayıncı bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const publisher = doc.data();
                        const publisherItem = document.createElement('li');
                        publisherItem.classList.add('text-lg', 'font-medium', 'text-primary');
                        publisherItem.textContent = publisher.email;
                        publishersList.appendChild(publisherItem);
                    });
                }
            });
        }
        
        function loadPublisherApplications() {
             if (!isAuthReady || auth.currentUser?.email !== 'baranss283@gmail.com') return;
            
            onSnapshot(query(publisherApplicationsCollection, where('status', '==', 'pending')), (snapshot) => {
                publisherApplicationsList.innerHTML = '';
                if (snapshot.empty) {
                    publisherApplicationsList.innerHTML = '<p class="text-primary/70">Bekleyen başvuru bulunmuyor.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const application = doc.data();
                        const appItem = document.createElement('div');
                        appItem.classList.add('card', 'p-4', 'rounded-lg', 'border', 'border-border-color');
                        appItem.innerHTML = `
                            <p class="text-lg font-semibold text-primary">Başvuran: ${application.email}</p>
                            <p class="text-primary/70 mt-2">Soru 1: ${application.question1}</p>
                            <p class="text-primary/70 mt-2">Soru 2: ${application.question2}</p>
                            <div class="mt-4 space-x-2">
                                <button onclick="window.approvePublisherApplication('${doc.id}', '${application.userId}', '${application.email}')" class="bg-green-600 text-white px-4 py-2 rounded-full hover:bg-green-700 transition duration-300">Onayla</button>
                                <button onclick="window.rejectPublisherApplication('${doc.id}')" class="bg-red-600 text-white px-4 py-2 rounded-full hover:bg-red-700 transition duration-300">Reddet</button>
                            </div>
                        `;
                        publisherApplicationsList.appendChild(appItem);
                    });
                }
            });
        }
        
        function loadUsers() {
             if (!isAuthReady) return;
             onSnapshot(usersCollection, (snapshot) => {
                usersList.innerHTML = '';
                if (snapshot.empty) {
                    usersList.innerHTML = '<p class="text-center text-primary/70">Henüz hiç kullanıcı yok.</p>';
                    return;
                }
                snapshot.forEach((doc) => {
                    const userData = doc.data();
                    const userItem = document.createElement('div');
                    userItem.className = 'card p-3 rounded-lg flex justify-between items-center';
                    const isCurrentUser = doc.id === currentUserId;
                    userItem.innerHTML = `
                        <div>
                            <p class="text-sm font-semibold">${userData.email}</p>
                            <p class="text-xs text-primary/70">${userData.role}</p>
                        </div>
                        ${isCurrentUser ? '<span class="text-xs text-link-color">Siz</span>' : ''}
                    `;
                    usersList.appendChild(userItem);
                });
            }, (error) => {
                console.error("Kullanıcılar yüklenirken hata oluştu: ", error);
                showModalMessage("Kullanıcılar yüklenirken hata oluştu.", "error");
            });
        }

        function loadChatMessages() {
            if (!isAuthReady) return;
            onSnapshot(query(chatCollection), (snapshot) => {
                chatBox.innerHTML = '';
                const messages = snapshot.docs.map(doc => doc.data());
                messages.sort((a, b) => a.createdAt.toDate() - b.createdAt.toDate());

                messages.forEach(messageData => {
                    const messageElement = document.createElement('div');
                    const isCurrentUser = messageData.userId === currentUserId;
                    
                    const classesToAdd = (isCurrentUser ? 'self-end bg-blue-600 text-white' : 'self-start bg-gray-300 text-gray-800').split(' ');
                    messageElement.classList.add('my-2', 'p-3', 'rounded-lg', 'max-w-xs', 'break-words', 'shadow-md', 'transition-all', 'duration-300', ...classesToAdd);
                    
                    messageElement.innerHTML = `
                        <p class="text-xs text-gray-200 mb-1">${isCurrentUser ? 'Siz' : 'Kullanıcı ' + messageData.userId}</p>
                        <p>${messageData.message}</p>
                    `;
                    chatBox.appendChild(messageElement);
                });
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        function loadComments(newsId) {
            const commentsCollectionRef = collection(db, `artifacts/${appId}/public/data/news/${newsId}/comments`);
            onSnapshot(commentsCollectionRef, async (snapshot) => {
                commentsList.innerHTML = '';
                if (snapshot.empty) {
                    commentsList.innerHTML = '<p class="text-gray-400">Bu habere henüz yorum yapılmamış.</p>';
                } else {
                    const comments = snapshot.docs.map(doc => doc.data());
                    comments.sort((a, b) => a.timestamp.toDate() - b.timestamp.toDate());

                    const usersPromises = comments.map(comment => getDoc(doc(usersCollection, comment.userId)));
                    const usersDocs = await Promise.all(usersPromises);
                    const usersMap = new Map(usersDocs.map(userDoc => [userDoc.id, userDoc.data()]));

                    comments.forEach(comment => {
                        const user = usersMap.get(comment.userId) || { email: 'Anonim Kullanıcı', role: 'Okur' };
                        const commentElement = document.createElement('div');
                        commentElement.classList.add('comment-item');
                        commentElement.innerHTML = `
                            <p class="font-semibold text-gray-100">${user.email} <span class="text-sm text-gray-400">(${user.role})</span></p>
                            <p class="text-gray-300">${comment.comment}</p>
                            <p class="text-xs text-gray-500 mt-1">${comment.timestamp.toDate().toLocaleString('tr-TR')}</p>
                        `;
                        commentsList.appendChild(commentElement);
                    });
                }
            });
        }
        
        function loadUserNotifications() {
            if (!currentUserId) return;
            onSnapshot(collection(db, `artifacts/${appId}/users/${currentUserId}/notifications`), (snapshot) => {
                const notifications = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                notifications.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate());

                notificationList.innerHTML = '';
                let unreadCount = 0;
                if (notifications.length === 0) {
                    notificationList.innerHTML = `<p class="text-primary/70">Henüz bildiriminiz yok.</p>`;
                } else {
                    notifications.forEach(notif => {
                        if (!notif.isRead) {
                            unreadCount++;
                        }
                        const notifItem = document.createElement('div');
                        notifItem.classList.add('p-3', 'rounded-lg', 'border', 'border-border-color', 'notification-item', notif.isRead ? '' : 'bg-red-500/10');
                        notifItem.innerHTML = `
                            <p class="font-semibold text-primary">${notif.message}</p>
                            <p class="text-xs text-primary/70">${notif.timestamp.toDate().toLocaleString('tr-TR')}</p>
                        `;
                        notificationList.appendChild(notifItem);
                    });
                }
                updateNotificationBadge(unreadCount);
            });
        }
        
        // --- Publisher Actions ---
        window.approveNews = async (docId) => {
            if (!isAuthReady || (!isPublisher && auth.currentUser.email !== 'baranss283@gmail.com')) {
                window.showMessageBox("Yetki Hatası", "Bu işlemi gerçekleştirmek için yetkili bir yayıncı olmalısınız.");
                return;
            }
            const newsRef = doc(db, `artifacts/${appId}/public/data/news/${docId}`);
            try {
                await updateDoc(newsRef, {
                    status: 'approved'
                });
                window.showNotification('Yeni bir haber onaylandı!', 'success');
                window.showMessageBox("Başarılı", "Haber onaylandı.");
            } catch (error) {
                console.error("Haber onaylama hatası:", error);
                window.showMessageBox("Hata", "Haber onaylanırken bir sorun oluştu.");
            }
        };

        window.deleteNews = async (docId) => {
            if (!isAuthReady || (!isPublisher && auth.currentUser.email !== 'baranss283@gmail.com')) {
                window.showMessageBox("Yetki Hatası", "Bu işlemi gerçekleştirmek için yetkili bir yayıncı olmalısınız.");
                return;
            }
            const newsRef = doc(db, `artifacts/${appId}/public/data/news/${docId}`);
            try {
                await deleteDoc(newsRef);
                window.showMessageBox("Başarılı", "Haber silindi.");
            } catch (error) {
                console.error("Haber silme hatası:", error);
                window.showMessageBox("Hata", "Haber silinirken bir sorun oluştu.");
            }
        };

        window.approvePublisherApplication = async (docId, userId, email) => {
            if (!isAuthReady || auth.currentUser?.email !== 'baranss283@gmail.com') {
                window.showMessageBox("Yetki Hatası", "Bu işlemi gerçekleştirmek için admin olmalısınız.");
                return;
            }
            try {
                await setDoc(doc(publishersCollection, userId), {
                    email: email,
                    appliedAt: new Date(),
                    status: 'approved'
                });
                await updateDoc(doc(publisherApplicationsCollection, docId), {
                    status: 'approved'
                });
                await setDoc(doc(usersCollection, userId), { role: 'Yayıncı' }, { merge: true });

                window.showNotification(`${email} artık bir yayıncı!`, 'success');
                window.showMessageBox("Başarılı", `${email} kullanıcısı artık bir yayıncı.`);
            } catch (error) {
                console.error("Başvuru onaylama hatası:", error);
                window.showMessageBox("Hata", "Başvuru onaylanırken bir hata oluştu.");
            }
        };

        window.rejectPublisherApplication = async (docId) => {
             if (!isAuthReady || auth.currentUser?.email !== 'baranss283@gmail.com') {
                window.showMessageBox("Yetki Hatası", "Bu işlemi gerçekleştirmek için admin olmalısınız.");
                return;
            }
            try {
                 await updateDoc(doc(publisherApplicationsCollection, docId), {
                    status: 'rejected'
                });
                window.showMessageBox("Başarılı", "Başvuru reddedildi.");
            } catch (error) {
                console.error("Başvuru reddetme hatası:", error);
                window.showMessageBox("Hata", "Başvuru reddedilirken bir hata oluştu.");
            }
        };
        
        // --- Event Listeners for new features ---
        closeSettingsBtn.addEventListener('click', () => window.closeModal('settingsModal'));
        closeAccountsBtn.addEventListener('click', () => window.closeModal('accountsModal'));

        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) { window.closeModal('settingsModal'); }
        });

        accountsModal.addEventListener('click', (e) => {
            if (e.target === accountsModal) { window.closeModal('accountsModal'); }
        });
        
        themeSelect.addEventListener('change', () => {
            body.classList.remove('light', 'dark');
            body.classList.add(themeSelect.value);
            saveSettings();
        });

        // İlk görünümü ayarla ve kimlik doğrulama işlemini başlat
        window.showView('home');
        authenticateUser();
        
        // Sayfa yüklendiğinde ayarları ve bildirimleri göster
        window.onload = function () {
            loadSettings();
            window.showNotification('Sistem güncellendi! Yeni özellikler için göz atın.', 'info');
            loadNewsFeed(fictionalNewsData);
        }
    </script>
</body>
</html>
